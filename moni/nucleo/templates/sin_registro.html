<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/moni/static/css/sin_registro.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seleccion vertiente</title>
</head>
<body>
    <nav class="navbar">
        <img src="https://cdn-ua.hostingreactor.com/ua_www/cache/wp-content/uploads/2020/12/Logo_svg.svg" alt="Logo" class="logo">
        <ul class="navbar-nav">
            <li class="nav-item"><a href="page1.html">Inicio</a></li>
            <li class="nav-item"><a href="#">Servicios</a></li>
            <li class="nav-item"><a href="#">Acerca de</a></li>
            <li class="nav-item"><a href="#">Contacto</a></li>
        </ul>
        <a href="http://127.0.0.1:8000/#" class="cerrar-sesion">Volver</a>
    </nav>

    <main class="main">
        <div class="vertientes-contenedor">
            <!-- Contenedor para los elementos -->
            <div class="vertientes-header">
                <h1>Seleccione vertiente a buscar</h1>
            </div>
            <div class="vertientes-buscar">
                <div class="buscar">
                    <input type="text" class="filtro-comunidad" placeholder="Escriba una comunidad" style="margin-bottom: 5px;">
                    <select class="seleccion comunidad">
                        <option value="comunidad1">Comunidad 1</option>
                        <option value="comunidad2">Comunidad 2</option>
                        <option value="comunidad3">Comunidad 3</option>
                    </select>
                </div>
                <div class="buscar">
                    <input type="text" class="filtro-vertiente" placeholder="Escriba una vertiente" style="margin-bottom: 5px;">
                    <select class="seleccion vertiente">
                        <option value="vertiente1">Vertiente 1</option>
                        <option value="vertiente2">Vertiente 2</option>
                        <option value="vertiente3">Vertiente 3</option>
                    </select>
                </div>
                <div class="buscar">
                    <button class="ir">Ir</button>
                </div>
            </div>
            <div class="vertientes-footer">
                <h1>Vertiente seleccionada</h1>
                <div class="parametros-columnas">
                    <!-- Primera columna de parámetros -->
                    <div class="columna">
                        <div class="parametro">
                            <h2>Caudal</h2>
                            <p>10 m³/s</p>
                        </div>
                        <div class="parametro">
                            <h2>pH</h2>
                            <p>7.0</p>
                        </div>
                        <div class="parametro">
                            <h2>Conductividad</h2>
                            <p>200 µS/cm</p>
                        </div>
                    </div>
                    <!-- Segunda columna de parámetros -->
                    <div class="columna">
                        <div class="parametro">
                            <h2>Turbiedad</h2>
                            <p>9 NTU</p>
                        </div>
                        <div class="parametro">
                            <h2>Humedad</h2>
                            <p>40%</p>
                        </div>
                        <div class="parametro">
                            <h2>Temperatura</h2>
                            <p>25°C</p>
                        </div>
                    </div>
                </div>
                <div class="vertientes-datos">
                    <div class="vertientes-datos">
                        <p id="fecha-hora-datos">
                            Obtención de Datos:<br>
                            <span id="fecha-hora"></span>
                        </p>
                    </div>
                </div>
            </div>
            <div class="estado-vertiente">
                <p id="estado-vertiente-texto"></p>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2023 U.autonoma. Todos los derechos reservados.</p>
    </footer>

    <script>
        // Filtrado en tiempo real para la selección de comunidad
        const filtroComunidad = document.querySelector('.filtro-comunidad');
        const selectComunidad = document.querySelector('.seleccion.comunidad');

        filtroComunidad.addEventListener('input', () => {
            const filtro = filtroComunidad.value.toLowerCase();
            Array.from(selectComunidad.options).forEach((option) => {
                const comunidad = option.textContent.toLowerCase();
                if (comunidad.includes(filtro)) {
                    option.style.display = 'block';
                } else {
                    option.style.display = 'none';
                }
            });
        });

        // Filtrado en tiempo real para la selección de vertiente
        const filtroVertiente = document.querySelector('.filtro-vertiente');
        const selectVertiente = document.querySelector('.seleccion.vertiente');

        filtroVertiente.addEventListener('input', () => {
            const filtro = filtroVertiente.value.toLowerCase();
            Array.from(selectVertiente.options).forEach((option) => {
                const vertiente = option.textContent.toLowerCase();
                if (vertiente.includes(filtro)) {
                    option.style.display = 'block';
                } else {
                    option.style.display = 'none';
                }
            });
        });
    </script>

    <script>
        // Obtener el elemento de fecha y hora
        const fechaHoraElemento = document.getElementById('fecha-hora');

        // Función para actualizar la fecha y hora
        function actualizarFechaHora() {
            const ahora = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
            const fechaHoraFormateada = ahora.toLocaleDateString('es-ES', options);
            fechaHoraElemento.textContent = fechaHoraFormateada;
        }

        // Actualizar la fecha y hora inicial al cargar la página
        actualizarFechaHora();
    </script>

    <script>
        // Función para evaluar la calidad del agua
        function evaluarCalidadAgua(cambios) {
            const caudal = cambios.caudal;
            const ph = cambios.ph;
            const conductividad = cambios.conductividad;
            const turbiedad = cambios.turbiedad;
            const humedad = cambios.humedad;
            const temperatura = cambios.temperatura;

            // Definir criterios para condiciones óptimas o malas
            const criterios = {
                caudal: { min: 5, max: 20 }, // Ejemplo: caudal entre 5 y 20
                ph: { min: 6.5, max: 8.5 }, // Ejemplo: pH entre 6.5 y 8.5
                conductividad: { min: 100, max: 500 }, // Ejemplo: conductividad entre 100 y 500
                turbiedad: { max: 10 }, // Ejemplo: turbiedad menor a 10
                humedad: { min: 30, max: 70 }, // Ejemplo: humedad entre 30% y 70%
                temperatura: { min: 10, max: 30 } // Ejemplo: temperatura entre 10°C y 30°C
            };

            // Evaluar cada parámetro
            const condicionesBuenas = Object.keys(criterios).every(parametro => {
                const valor = cambios[parametro];
                if (valor !== undefined && criterios[parametro]) {
                    if (criterios[parametro].min !== undefined && valor < criterios[parametro].min) {
                        return false;
                    }
                    if (criterios[parametro].max !== undefined && valor > criterios[parametro].max) {
                        return false;
                    }
                }
                return true;
            });

            // Actualizar el estado de la vertiente en función de las condiciones
            const estadoVertienteTexto = document.getElementById('estado-vertiente-texto');
            if (condicionesBuenas) {
                estadoVertienteTexto.textContent = "El agua de la vertiente está en óptimas condiciones";
                estadoVertienteTexto.classList.add('condiciones-buenas');
            } else {
                estadoVertienteTexto.textContent = "El agua de la vertiente está en malas condiciones";
                estadoVertienteTexto.classList.add('condiciones-malas');
            }
        }

        // Obtener los valores de los parámetros desde los elementos HTML
        const parametrosColumnas = $('.parametros-columnas');

        // Expresión regular para extraer números con decimales de una cadena
        const numeroRegex = /[-]{0,1}[\d]*[.]{0,1}[\d]+/g;

        // Función para extraer y convertir un valor de cadena en un número
        function obtenerNumeroDesdeCadena(cadena) {
            const numeros = cadena.match(numeroRegex);
            if (numeros && numeros.length > 0) {
                return parseFloat(numeros[0]);
            }
            return undefined;
        }

        // Obtener y convertir los valores de los parámetros
        const caudalElemento = parametrosColumnas.find('.parametro h2:contains("Caudal")').next('p');
        const phElemento = parametrosColumnas.find('.parametro h2:contains("pH")').next('p');
        const conductividadElemento = parametrosColumnas.find('.parametro h2:contains("Conductividad")').next('p');
        const turbiedadElemento = parametrosColumnas.find('.parametro h2:contains("Turbiedad")').next('p');
        const humedadElemento = parametrosColumnas.find('.parametro h2:contains("Humedad")').next('p');
        const temperaturaElemento = parametrosColumnas.find('.parametro h2:contains("Temperatura")').next('p');

        // Crear el objeto cambios con los valores obtenidos y convertidos
        const cambios = {
            caudal: obtenerNumeroDesdeCadena(caudalElemento.text()),
            ph: obtenerNumeroDesdeCadena(phElemento.text()),
            conductividad: obtenerNumeroDesdeCadena(conductividadElemento.text()),
            turbiedad: obtenerNumeroDesdeCadena(turbiedadElemento.text()),
            humedad: obtenerNumeroDesdeCadena(humedadElemento.text()),
            temperatura: obtenerNumeroDesdeCadena(temperaturaElemento.text()),
        };

        evaluarCalidadAgua(cambios);
    </script>

</body>
</html>